# PRS On-Premises Production Configuration
# Adapted from EC2 Graviton setup for on-premises deployment
# Optimized for 16GB RAM, 100 concurrent users, and dual storage (SSD/HDD)
# Copy this file to .env and customize for your on-premises deployment

# =============================================================================
# BASIC CONFIGURATION
# =============================================================================

# Application Version and Environment
VERSION=latest
NODE_ENV=production

# Frontend Build Configuration (Production)
VITE_APP_API_URL=https://prs.client-domain.com/api
VITE_APP_UPLOAD_URL=https://prs.client-domain.com/upload
VITE_APP_ENVIRONMENT=production
VITE_APP_ENABLE_DEVTOOLS=false

# Server Configuration (On-Premises Internal Network)
SERVER_IP=192.168.0.100
DOMAIN=prs.client-domain.com
HTTP_PORT=80
HTTPS_PORT=443

# Network Configuration (Internal Network)
NETWORK_NAME=prs_onprem_network
NETWORK_SUBNET=192.168.100.0/24
CORS_ORIGIN=https://prs.client-domain.com,http://192.168.0.0/20

# Public Access Control (On-premises - internal only)
ENABLE_PUBLIC_ACCESS=false
ALLOWED_IPS=192.168.0.0/20
INTERNAL_NETWORK_ONLY=true
ONPREM_DEPLOYMENT=true

# =============================================================================
# DATABASE CONFIGURATION (Optimized for 16GB RAM)
# =============================================================================

# PostgreSQL Basic Settings
POSTGRES_DB=prs_production
POSTGRES_USER=prs_user
POSTGRES_PASSWORD=CHANGE_THIS_SUPER_STRONG_PASSWORD_123!
DIALECT=postgres

# PostgreSQL Performance Settings (16GB RAM Optimized)
POSTGRES_MAX_CONNECTIONS=150
POSTGRES_SHARED_BUFFERS=2GB
POSTGRES_EFFECTIVE_CACHE_SIZE=12GB
POSTGRES_WORK_MEM=32MB
POSTGRES_MAINTENANCE_WORK_MEM=512MB
POSTGRES_WAL_BUFFERS=32MB
POSTGRES_MAX_WAL_SIZE=2GB
POSTGRES_MIN_WAL_SIZE=512MB
POSTGRES_CHECKPOINT_TIMEOUT=15min
POSTGRES_EFFECTIVE_IO_CONCURRENCY=200

# PostgreSQL SSL Configuration
POSTGRES_SSL_ENABLED=true
POSTGRES_SSL_REQUIRE=false
POSTGRES_SSL_REJECT_UNAUTHORIZED=false
POSTGRES_SSL_MODE=on
POSTGRES_SSL_CERT_FILE=/etc/ssl/certs/server.crt
POSTGRES_SSL_KEY_FILE=/etc/ssl/private/server.key

# PostgreSQL Logging
POSTGRES_LOG_STATEMENT=mod
POSTGRES_LOG_MIN_DURATION=1000

# Database Pool Configuration (100 concurrent users)
POOL_MIN=5
POOL_MAX=20
POOL_ACQUIRE=30000
POOL_IDLE=10000
POOL_EVICTION=20000

# Database Connection Settings
DB_CONNECTION_TIMEOUT=30000
DB_QUERY_TIMEOUT=60000
DB_IDLE_TIMEOUT=10000

# =============================================================================
# TIMESCALEDB PRODUCTION CONFIGURATION (On-Premises 16GB RAM)
# =============================================================================

# TimescaleDB Core Settings
TIMESCALEDB_TELEMETRY=off
TIMESCALEDB_MAX_BACKGROUND_WORKERS=16

# PostgreSQL Worker Process Settings (16GB RAM Optimized)
POSTGRES_MAX_WORKER_PROCESSES=32
POSTGRES_MAX_PARALLEL_WORKERS=16
POSTGRES_MAX_PARALLEL_WORKERS_PER_GATHER=4

# TimescaleDB Compression Settings (for data growth management)
TIMESCALEDB_COMPRESSION_ENABLED=true
TIMESCALEDB_COMPRESSION_INTERVAL=7d
TIMESCALEDB_RETENTION_POLICY=1y

# TimescaleDB Chunk Settings (optimized for time-series data)
TIMESCALEDB_CHUNK_TIME_INTERVAL=1d
TIMESCALEDB_CHUNK_TARGET_SIZE=25MB

# TimescaleDB Storage Settings (SSD/HDD strategy)
TIMESCALEDB_HOT_DATA_INTERVAL=30d
TIMESCALEDB_COLD_DATA_INTERVAL=90d

# =============================================================================
# REDIS CONFIGURATION (Optimized for 16GB RAM)
# =============================================================================

REDIS_ENABLED=true
REDIS_PASSWORD=CHANGE_THIS_REDIS_PASSWORD_456!
REDIS_MEMORY_LIMIT=2g
CACHE_TTL=3600

# =============================================================================
# APPLICATION SECRETS (CHANGE ALL OF THESE!)
# =============================================================================

JWT_SECRET=CHANGE_THIS_JWT_SECRET_VERY_LONG_AND_RANDOM_STRING_789!
ENCRYPTION_KEY=CHANGE_THIS_ENCRYPTION_KEY_32_CHARS_LONG_ABC123!
OTP_KEY=CHANGE_THIS_OTP_KEY_RANDOM_STRING_DEF456!
PASS_SECRET=CHANGE_THIS_PASS_SECRET_GHI789!
BYPASS_OTP=false

# =============================================================================
# EXTERNAL API CONFIGURATION
# =============================================================================

CITYLAND_API_URL=https://api.cityland.example.com
CITYLAND_ACCOUNTING_URL=https://accounting.cityland.example.com
CITYLAND_API_USERNAME=your_api_username
CITYLAND_API_PASSWORD=your_api_password

# =============================================================================
# MEMORY ALLOCATION (16GB RAM Distribution)
# =============================================================================

# Backend API (4GB for 100 concurrent users)
BACKEND_MEMORY_LIMIT=4g

# Frontend (1GB for improved caching)
FRONTEND_MEMORY_LIMIT=1g

# PostgreSQL (6GB for database operations)
POSTGRES_MEMORY_LIMIT=6g

# Redis (2GB for caching and queues)
REDIS_MEMORY_LIMIT=2g

# Redis Worker (1GB for background processing)
WORKER_MEMORY_LIMIT=1g

# Nginx (256MB for reverse proxy)
NGINX_MEMORY_LIMIT=256m

# Monitoring Services
PROMETHEUS_MEMORY_LIMIT=1g
GRAFANA_MEMORY_LIMIT=1g

# =============================================================================
# MONITORING CONFIGURATION
# =============================================================================

# Prometheus Settings (Enhanced for On-Premises)
PROMETHEUS_ENABLED=true
PROMETHEUS_RETENTION_TIME=30d
PROMETHEUS_RETENTION_SIZE=10GB

# Grafana Settings
GRAFANA_ENABLED=true
GRAFANA_PORT=3001
GRAFANA_ADMIN_PASSWORD=CHANGE_THIS_GRAFANA_PASSWORD_JKL012!
GRAFANA_SUBDOMAIN=grafana
GRAFANA_DATA_RETENTION=30d

# Node Exporter
NODE_EXPORTER_ENABLED=true

# cAdvisor
CADVISOR_ENABLED=true

# Adminer Settings
ADMINER_PORT=8080
ADMINER_SUBDOMAIN=adminer

# Portainer Settings
PORTAINER_PORT=9000
DOCKER_SOCK_PATH=/var/run/docker.sock

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

LOG_LEVEL=info
LOG_RETENTION_DAYS=30
LOG_MAX_SIZE=100m
ENABLE_DEBUG_LOGS=false

# =============================================================================
# ROOT USER CONFIGURATION
# =============================================================================

ROOT_USER_NAME=admin
ROOT_USER_EMAIL=admin@client-domain.com
ROOT_USER_PASSWORD=CHANGE_THIS_ROOT_PASSWORD_MNO345!

# =============================================================================
# BACKUP CONFIGURATION (Zero-Deletion Policy)
# =============================================================================

BACKUP_ENABLED=true
BACKUP_RETENTION_DAYS=0
BACKUP_SCHEDULE="0 2 * * *"
BACKUP_COMPRESSION=true

# =============================================================================
# SSL CONFIGURATION (Let's Encrypt)
# =============================================================================

SSL_CERT_PATH=./ssl/server.crt
SSL_KEY_PATH=./ssl/server.key
SSL_DHPARAM_PATH=./ssl/dhparam.pem

# =============================================================================
# HEALTH CHECK CONFIGURATION
# =============================================================================

HEALTH_CHECK_INTERVAL=30s
HEALTH_CHECK_TIMEOUT=10s
HEALTH_CHECK_RETRIES=3
HEALTH_CHECK_PATH=/health
METRICS_PATH=/metrics
STATUS_PATH=/status

# =============================================================================
# PERFORMANCE TUNING FOR ON-PREMISES (16GB RAM)
# =============================================================================

# Docker optimizations
DOCKER_BUILDKIT=1
COMPOSE_DOCKER_CLI_BUILD=1

# Memory management (16GB RAM optimized)
NODEJS_MAX_OLD_SPACE_SIZE=2048

# Container restart policy
RESTART_POLICY=unless-stopped
DOCKER_RESTART_POLICY=unless-stopped

# =============================================================================
# SECURITY SETTINGS
# =============================================================================

# Security Headers
ENABLE_SECURITY_HEADERS=true
ENABLE_RATE_LIMITING=true
ENABLE_HELMET=true
ENABLE_CORS_CREDENTIALS=true
SECURE_COOKIES=true
SAME_SITE_COOKIES=strict

# Session Configuration
SESSION_TIMEOUT=3600
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION=900

# Content Security Policy
CSP_ENABLED=true
CSP_REPORT_ONLY=false

# Production Security Flags
SKIP_SSL_VERIFICATION=false
ENABLE_MOCK_APIS=false
ENABLE_TEST_DATA=false

# =============================================================================
# FILE UPLOAD CONFIGURATION
# =============================================================================

MAX_FILE_SIZE=50m
UPLOAD_MAX_FILES=10
UPLOAD_MAX_SIZE_PER_FILE=10m
UPLOAD_ALLOWED_EXTENSIONS=pdf,doc,docx,xls,xlsx,jpg,jpeg,png,gif
ALLOWED_FILE_TYPES=pdf,doc,docx,xls,xlsx,jpg,jpeg,png,gif

# =============================================================================
# API RATE LIMITING
# =============================================================================

API_RATE_LIMIT_WINDOW=15
API_RATE_LIMIT_MAX_REQUESTS=100

# =============================================================================
# EMAIL CONFIGURATION (Configure with your SMTP provider)
# =============================================================================

SMTP_HOST=your-smtp-server.com
SMTP_PORT=587
SMTP_USER=your-smtp-username
SMTP_PASSWORD=your-smtp-password
SMTP_FROM="PRS System <noreply@client-domain.com>"

# =============================================================================
# ERROR HANDLING
# =============================================================================

ERROR_STACK_TRACE=false
ERROR_DETAILS=false

# =============================================================================
# PERFORMANCE MONITORING
# =============================================================================

ENABLE_APM=false
APM_SERVICE_NAME=prs-onprem
ENABLE_METRICS=true
ENABLE_HEALTH_CHECKS=true
ENABLE_AUDIT_LOGS=true

# =============================================================================
# FEATURE FLAGS
# =============================================================================

FEATURE_NEW_UI=true
FEATURE_ADVANCED_SEARCH=true
FEATURE_BULK_OPERATIONS=true

# Development Features (Disabled for Production)
ENABLE_HOT_RELOAD=false
ENABLE_CORS_ALL=false

# =============================================================================
# MAINTENANCE MODE
# =============================================================================

MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE="System is under maintenance. Please try again later."

# =============================================================================
# CLEANUP SETTINGS (Zero-Deletion Compliant)
# =============================================================================

AUTO_CLEANUP_LOGS=false
AUTO_CLEANUP_TEMP_FILES=false
CLEANUP_SCHEDULE="0 3 * * *"

# =============================================================================
# REPOSITORY CONFIGURATION
# =============================================================================

# Base directory where repositories are located
REPO_BASE_DIR=/opt/prs

# Repository names (directories)
BACKEND_REPO_NAME=prs-backend-a
FRONTEND_REPO_NAME=prs-frontend-a

# Repository URLs (for cloning if directories don't exist)
BACKEND_REPO_URL=https://github.com/your-org/prs-backend-a.git
FRONTEND_REPO_URL=https://github.com/your-org/prs-frontend-a.git

# Git branches to use
BACKEND_BRANCH=main
FRONTEND_BRANCH=main

# =============================================================================
# TIMEZONE
# =============================================================================

TZ=Asia/Manila

# =============================================================================
# DOCKER CONFIGURATION
# =============================================================================

DOCKER_COMPOSE_VERSION=v2
DOCKER_RESTART_POLICY=unless-stopped

# =============================================================================
# ON-PREMISES SPECIFIC SETTINGS
# =============================================================================

# Hardware Configuration
ONPREM_RAM_SIZE=16GB
ONPREM_SSD_SIZE=470GB
ONPREM_HDD_SIZE=2400TB
ONPREM_NETWORK=192.168.0.0/20

# Storage Paths
SSD_MOUNT_PATH=/mnt/ssd
HDD_MOUNT_PATH=/mnt/hdd
NAS_BACKUP_PATH=/mnt/nas

# Network Configuration
INTERNAL_NETWORK_GATEWAY=192.168.100.1
INTERNAL_NETWORK_DNS=192.168.1.1,8.8.8.8

# Firewall Configuration (Managed by IT Team)
FIREWALL_MANAGED_BY_IT=true
INTRUSION_DETECTION_ENABLED=true

# =============================================================================
# MONITORING ENDPOINTS AND PATHS
# =============================================================================

# Application Endpoints
HEALTH_CHECK_PATH=/health
METRICS_PATH=/metrics
STATUS_PATH=/status

# Monitoring URLs (Internal Network)
PROMETHEUS_URL=http://192.168.0.100:9090
GRAFANA_URL=http://192.168.0.100:3001
ADMINER_URL=http://192.168.0.100:8080
PORTAINER_URL=http://192.168.0.100:9000

# =============================================================================
# BACKUP AND ARCHIVE PATHS
# =============================================================================

# SSD Paths (Hot Data)
SSD_POSTGRESQL_PATH=/mnt/ssd/postgresql-data
SSD_REDIS_PATH=/mnt/ssd/redis-data
SSD_UPLOADS_PATH=/mnt/ssd/uploads
SSD_LOGS_PATH=/mnt/ssd/logs
SSD_NGINX_CACHE_PATH=/mnt/ssd/nginx-cache

# HDD Paths (Cold Data and Archives)
HDD_POSTGRESQL_COLD_PATH=/mnt/hdd/postgresql-cold
HDD_BACKUP_PATH=/mnt/hdd/backups
HDD_ARCHIVE_PATH=/mnt/hdd/archives
HDD_LOGS_ARCHIVE_PATH=/mnt/hdd/logs-archive

# NAS Paths (Off-site Backup)
NAS_BACKUP_PATH=/mnt/nas/prs-backups
NAS_ARCHIVE_PATH=/mnt/nas/prs-archives

# =============================================================================
# PRODUCTION OPTIMIZATION FLAGS
# =============================================================================

# Performance Flags
ENABLE_GZIP_COMPRESSION=true
ENABLE_STATIC_FILE_CACHING=true
ENABLE_DATABASE_QUERY_CACHE=true
ENABLE_REDIS_PERSISTENCE=true

# Security Flags
ENABLE_CSRF_PROTECTION=true
ENABLE_XSS_PROTECTION=true
ENABLE_CLICKJACKING_PROTECTION=true
ENABLE_CONTENT_TYPE_SNIFFING_PROTECTION=true

# Monitoring Flags
ENABLE_PERFORMANCE_MONITORING=true
ENABLE_ERROR_TRACKING=true
ENABLE_UPTIME_MONITORING=true
ENABLE_RESOURCE_MONITORING=true

# =============================================================================
# CAPACITY PLANNING SETTINGS
# =============================================================================

# Expected Load (100 Concurrent Users)
EXPECTED_CONCURRENT_USERS=100
EXPECTED_DAILY_REQUESTS=1000000
EXPECTED_DAILY_DATA_GROWTH=20GB
EXPECTED_MONTHLY_DATA_GROWTH=600GB

# Performance Targets
TARGET_RESPONSE_TIME_MS=200
TARGET_UPTIME_PERCENTAGE=99.9
TARGET_ERROR_RATE_PERCENTAGE=0.1

# Resource Thresholds
CPU_USAGE_WARNING_THRESHOLD=70
CPU_USAGE_CRITICAL_THRESHOLD=85
MEMORY_USAGE_WARNING_THRESHOLD=75
MEMORY_USAGE_CRITICAL_THRESHOLD=90
DISK_USAGE_WARNING_THRESHOLD=80
DISK_USAGE_CRITICAL_THRESHOLD=90
